
<%= partial :group_header %>

<% if params[:applied] or (current_account and @mapplicaton = @group.mapplications.find_by(account: current_account)) %>

  <h2>Thanks for expressing your interest</h2>

  <p>
    Your application is visible to all existing members.    
  </p>

  <% if @group.threshold %>
    <p>    
      Applications are accepted upon gathering <%=@group.threshold%> proposers + supporters.
      <% if @group.democratic_threshold %>
      (This number is decided democratically by all group members.)
      <% end %>    
    <% end %>
  </p>


<% else %>

  <div class="row" style="margin-top: 15px">
    <div class="col-sm-4 col-sm-push-8">

      <div style="margin-bottom: 15px">
        <h2 style="margin-top: 0">Co-creators</h2>
        <% (Account.where(:id.in => @group.memberships.pluck(:account_id)).where(:picture_uid.ne => nil).shuffle + Account.where(:id.in => @group.memberships.pluck(:account_id)).where(:picture_uid => nil).shuffle).each { |account| %><img style="width: 50px; margin-bottom: 5px; margin-right: 5px;" data-toggle="tooltip" title="<%=account.name%>" src="<%=account.picture ? account.picture.thumb('400x400#').url : '/images/silhouette.png'%>" /><% } %>      
      </div>

    </div>    
    <div class="col-sm-8 col-sm-pull-4">

      <% if @group.application_preamble %>
        <%=@group.application_preamble%>
      <% end %>

      <% form_for @account, "/h/#{@group.slug}/apply", :class => 'form-horizontal' do |f| %>

        <script>
          $(function () {
            $('.form-group > div.col-sm-6').removeClass('col-sm-6').addClass('col-sm-8')
          })
        </script>
        <% if !current_account %>
          <%= f.text_block :name %>
          <%= f.text_block :email %>
          <%= f.image_block :picture %>  
          <% if @group.ask_for_date_of_birth %>
            <%= f.date_block :date_of_birth, :start_year => 1900, :end_year => Time.now.year %>
          <% end %>
          <% if @group.ask_for_gender %>
            <%= f.select_block :gender %>
          <% end %>
          <% if @group.ask_for_poc %>
            <%= f.check_box_block :poc %>      
          <% end %>
        <% end %>

        <% @group.application_questions_a.each_with_index { |q,i| %>
          <div class="form-group">
            <label class="control-label col-sm-3"><%=q%></label>
            <div class="col-sm-6">  
              <%= text_area_tag "answers[#{i}]", :class => 'form-control' %>
            </div>
          </div>  
        <% } %>

        <%= f.submit_block button_text: ((current_account and @group.application_questions_a.count == 0) ? 'Express interest' : 'Submit') %>            

      <% end %>      

    </div>
  </div>

<% end %>