<% if @membership.admin? %>
  <% form_tag "/tiers/create?group_id=#{@group.id}", :class => 'form-inline', :style => 'margin-top: 10px' do %>
    <%= text_field_tag :name, :required => true, :class => 'form-control', :style => 'width: 10em', :placeholder => 'New tier' %>
    <%= text_field_tag :description, :class => 'form-control', :style => 'width: 10em', :placeholder => 'Description' %>          

    <div class="input-group">
      <span class="input-group-addon"><%=@group.currency_symbol%></span>
      <%= number_field_tag :cost, :required => true, :class => 'form-control', :style => 'width: 8em', :placeholder => 'Cost' %>
    </div>

    <%= submit_tag 'Submit', :class => 'btn btn-primary' %>

  <% end %>    
<% end %>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Tier</th>
      <th>Cost</th>
      <th></th>
      <th>People</th> 
    </tr>
  </thead>
  <% @group.tiers.order('cost asc').each { |tier| %>
    <tr>
      <td>
        <% if @membership.admin? %>
          <a data-confirm="Delete this tier?" href="/tiers/<%=tier.id%>/destroy">
            <%=tier.name%>
          </a>
        <% else %>
          <%=tier.name%>
        <% end %>       
        <br />
        <%= tier.description %>
      </td>
      <td>
        <%=@group.currency_symbol%><%=tier.cost%>
      </td>
      <td>
        <% if tiership = @group.tierships.find_by(tier: tier, account: current_account) %>
          <a class="pagelet-trigger btn btn-primary" href="/tierships/<%=tiership.id%>/destroy">Leave</a>
        <% elsif !@group.tierships.find_by(account: current_account) %>
          <a class="pagelet-trigger btn btn-primary" href="/tierships/create?tier_id=<%=tier.id%>">Join</a>
        <% end %>
      </td>      
      <td>
        <% y = [] %>
        <% tier.tierships.each { |tiership| account = tiership.account; %>
          <% if params[:view] == 'names' %>
            <% y << capture do %>   
              <%= account.name %>
            <% end %>
          <% else %>
            <% y << capture do %><img data-toggle="tooltip" title="<%=account.name%>" style="width: 50px;" src="<%=account.picture ? account.picture.thumb('400x400#').url : '/images/silhouette.png'%>" /><% end %>
          <% end %>
        <% } %>
        <% if params[:view] == 'names' %>
          <%= y.map(&:strip).join(', ') %>
        <% else %>
          <%= y.map(&:strip).join('') %>
        <% end %>       
      </td>
    </tr>
  <% } %>
</table>

<% if params[:view] != 'names' %>
  <a onclick="$(this).closest('[data-pagelet-url]').attr('data-pagelet-url', '/h/<%=@group.slug%>/accoms?view=names')" href="#" class="pagelet-trigger">Show names instead of pictures</a>
<% end %>