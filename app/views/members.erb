
<%= partial :group_header %>

<table class="table table-striped">
  <thead>
    <tr>
      <th style="width: 1px">Name</th>      
      <th>Proposed by</th>
      <th>Accepted at</th>
      <th>Accepted on</th>
      <% if @membership.admin %>
        <% if @group.facebook_group %>
          <th>Added to Facebook group?</th>
        <% end %>
      <% end %>
      <th>Paid</th>
      <% if @membership.admin %>
        <th></th>
      <% end %>           
    </tr>
  </thead>
  <% @group.memberships.order('created_at desc').each { |membership| account = membership.account %>
    <tr>
      <td>
        <%= partial :account, :object => account, :locals => {:membership => membership} %>
        <div>
          <% membership.teamships.each { |teamship| %>
            <span class="label label-primary"><%=teamship.team.name%></span>
          <% } %>        
        </div>
      </td>
      <td>
        <%= membership.mapplication ? membership.mapplication.verdicts.proposers.map { |verdict| verdict.account.name }.to_sentence : '' %>
      </td>        
      <td>
        <% if membership.mapplication; mapplication = membership.mapplication %>
          <%=pluralize(mapplication.verdicts.supporters.count,'supporter') %>

          <% if mapplication.answers %>
            <div>
              <a href="javascript:;" onclick="$('#modal .modal-content').load('/mapplications/<%=mapplication.id%>', function () {
                          $('#modal').modal('show')
                        });">
                <i class="fa fa-file-text-o" style="font-size: 20px"></i>
              </a>
            </div>
          <% end %>
        <% end %>
      </td>  
      <td>
        <%= membership.created_at %>
      </td>
      <% if @membership.admin? %>
        <% if @group.facebook_group %>
          <td>
            <% if membership.added_to_facebook_group  %>
              <i class="fa fa-check"></i>
            <% else %>
              <input type="checkbox" onclick="window.location = '/memberships/<%=membership.id%>/added_to_facebook_group'">
            <% end %>
          </td>      
        <% end %>
      <% end %>
      <td>
        <% if @membership.admin? %>
          <% form_tag "/memberships/#{membership.id}/paid" do %>
            <div class="input-group">
              <span class="input-group-addon">£</span>
              <%= number_field_tag :paid, :class => 'form-control', :style => 'width: 6em', :value => membership.paid %>
            </div>
          <% end %>
        <% else %>
          <%= "£#{membership.paid}" if membership.paid %>
        <% end %>
      </td>   
      <% if @membership.admin? %>
        <td>
          <% if !membership.admin %>
            <a class="btn btn-success" href="/memberships/<%=membership.id%>/make_admin">Make admin</a>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% } %>
  <tr>
    <th></th>      
    <th></th>
    <th></th>
    <th></th>
    <% if @membership.admin %>
      <% if @group.facebook_group %>
        <th></th>
      <% end %>
    <% end %>        
    <th>£<%= @group.memberships.pluck(:paid).compact.sum %></th>
    <% if @membership.admin %>
      <th></th>
    <% end %>        
  </tr>
</table>