
<% form_tag '', :style => 'display:inline', :method => 'get' do %>
  <%= text_field_tag :q, :class => 'form-control', :style => 'width: auto; display: inline-block', :placeholder => 'Search applicants', :value => params[:q] %>
  &middot;

  <style>
    .views a { opacity: 0.5 }
    .views a.active { opacity: 1 }      
  </style>
  <div class="views" style="display: inline">
    <a href="?" <% if !params[:view] %>class="active"<% end %>  ><i title="Table view" class="fa fa-table"></i></a>    
    <a href="?view=wall" <% if params[:view] == 'wall' %>class="active"<% end %>><i title="Wall view" class="fa fa-th-large"></i></a>
    <% if @membership.admin? %>
      <a href="?view=emails" <% if params[:view] == 'emails' %>class="active"<% end %>><i title="Emails" class="fa fa-envelope"></i></a>
    <% end %>
  </div>

<% end %>

<% if params[:view] == 'wall' %>

  <div style="margin-top: 15px">
    <% (Account.where(:id.in => @mapplications.pluck(:account_id)).where(:picture_uid.ne => nil).shuffle + Account.where(:id.in => @mapplications.pluck(:account_id)).where(:picture_uid => nil).shuffle).each { |account| %><img style="width: 149px; margin-bottom: 5px; margin-right: 5px;" data-toggle="tooltip" title="<%=account.name%>" src="<%=account.picture ? account.picture.thumb('400x400#').url : '/images/silhouette.png'%>" /><% } %>      
  </div>

<% elsif params[:view] == 'emails' %>

  <pre style="margin-top: 15px;"><%= Account.where(:id.in => @mapplications.pluck(:account_id)).map do |account| "#{account.name} &lt;#{account.email}&gt;" end.join(', ') %></pre>


<% else @mapplications = @mapplications.per_page(10).page(params[:page]) %>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Applied on</th>
        <th>Application</th>      
        <th>Proposers, supporters and blockers</th>     
        <% if @membership.admin? %>
          <th></th>
        <% end %>
      </tr>
    </thead>  
    <% @mapplications.order('created_at desc').each { |mapplication| %>
      <tr data-pagelet-url="/mapplication_row/<%=mapplication.id%>">
        <%= partial :mapplication_row, :locals => {:mapplication => mapplication}  %>
      </tr>
    <% } %>
  </table>

  <div style="text-align: center">
    <%= will_paginate @mapplications, :renderer => WillPaginate::ViewHelpers::BootstrapRenderer %>
  </div>  

<% end %>